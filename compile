#!/usr/bin/ruby
fname = ARGV[0]
dir = File.dirname(__FILE__)
bname = File.basename(fname).split(".")[0..-2].join(".")

# If we want to pass the "-g" flag to gas, pass "-g",
# and you will be able to debug at the assembler level.
asmdebug = ARGV.include?("-g") ? "-g" : ""

if system("ruby #{dir}/compiler.rb #{ARGV.join(" ")} 2>&1 >#{bname}.s")
  if system("gcc #{asmdebug} -m32 -o #{bname} #{bname}.s")
    puts "Compiled to #{bname}"
  else
    STDERR.puts "*** Assembly failed."
    exit(1)
  end
else
  STDERR.puts "*** Compilation failed."
  exit(1)
end
